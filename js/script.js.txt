const form = document.getElementById("form");
const input = document.getElementById("input");
const todosList = document.getElementById("todos");

// Verificar si los elementos existen antes de continuar
if (form && input && todosList) {
  const updateLocalStorage = () => {
    const todosElements = document.querySelectorAll("li");
    const todos = [];
    todosElements.forEach((todoElement) => {
      todos.push({
        text: todoElement.querySelector("span").textContent, // Se cambia innerText por textContent
        completed: todoElement.classList.contains("completed"),
      });
    });
    localStorage.setItem("todos", JSON.stringify(todos));
  };

  const createTodoElement = (todoText, completed = false) => {
    const todoElement = document.createElement("li");

    const textSpan = document.createElement("span");
    textSpan.textContent = todoText; // Se usa textContent

    const checkIcon = document.createElement("span");
    checkIcon.innerHTML = "✔️";
    checkIcon.classList.add("check-icon");
    checkIcon.style.display = completed ? "inline" : "none";

    if (completed) {
      todoElement.classList.add("completed");
    }

    todoElement.appendChild(textSpan);
    todoElement.appendChild(checkIcon);

    todoElement.addEventListener("click", () => {
      todoElement.classList.toggle("completed");
      checkIcon.style.display = todoElement.classList.contains("completed") ? "inline" : "none";
      updateLocalStorage();
    });

    todoElement.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      removeTodo(todoElement);
    });

    return todoElement;
  };

  const removeTodo = (todoElement) => {
    todoElement.remove();
    updateLocalStorage();
  };

  const addTodo = (todo = null) => {
    let todoText = input.value.trim();
    if (todo) todoText = todo.text;
    if (todoText) {
      const todoElement = createTodoElement(todoText, todo?.completed);
      todosList.appendChild(todoElement);
      input.value = "";
      updateLocalStorage();
    }
  };

  const todos = JSON.parse(localStorage.getItem("todos")) || [];
  todos.forEach((todo) => addTodo(todo));

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    addTodo();
  });
}
